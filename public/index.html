<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator - Powered by MCP.run</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            line-height: 1.6;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        .container {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            display: block;
            margin: 0 auto;
        }
        button:hover {
            background-color: #2980b9;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        #qrImage {
            max-width: 250px;
            max-height: 250px;
            margin: 15px auto;
            display: block;
        }
        .status {
            color: #666;
            font-style: italic;
            text-align: center;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            font-size: 14px;
            color: #7f8c8d;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 2s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .note {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 10px 15px;
            margin: 15px 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>QR Code Generator</h1>
    <p style="text-align: center;">Powered by the <a href="https://mcp.run/nilslice/qr-code" target="_blank">QR Code servlet</a> from MCP.run</p>
    
    <div class="container">
        <form id="qrForm">
            <div>
                <label for="content">Text or URL for QR Code:</label>
                <textarea id="content" rows="4" placeholder="Enter the text or URL you want to encode in the QR code"></textarea>
            </div>
            
            <div>
                <label for="size">Size (pixels):</label>
                <input type="text" id="size" value="250" placeholder="Enter size in pixels (e.g., 250)">
            </div>
            
            <button type="submit" id="generateBtn">Generate QR Code</button>
        </form>
        
        <div class="loading" id="loadingIndicator">
            <div class="loading-spinner"></div>
            <p>Generating QR code...</p>
        </div>
        
        <div id="result">
            <p class="status">Your QR code will appear here</p>
        </div>
        
        <div class="note">
            <p><strong>Note:</strong> This demo is currently using a third-party QR code service instead of the MCP.run servlet due to technical limitations with connecting to MCP.run from serverless functions. The code repository still contains the implementation for both approaches.</p>
        </div>
    </div>
    
    <div class="container">
        <h3>About This Tool</h3>
        <p>This website uses the QR Code servlet from MCP.run to generate QR codes. The Model Context Protocol (MCP) allows AI models to interact with external tools like this QR code generator.</p>
        <p>To use this tool, simply enter the text or URL you want to encode in a QR code, specify the size, and click "Generate QR Code".</p>
    </div>
    
    <div class="footer">
        <p>Created with ❤️ using <a href="https://mcp.run" target="_blank">MCP.run</a> servlets</p>
    </div>

    <script>
        document.getElementById('qrForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const content = document.getElementById('content').value.trim();
            const size = document.getElementById('size').value.trim();
            const resultDiv = document.getElementById('result');
            const loadingIndicator = document.getElementById('loadingIndicator');
            
            if (!content) {
                resultDiv.innerHTML = '<p class="error">Please enter text or a URL to encode</p>';
                return;
            }
            
            if (!size || isNaN(size) || parseInt(size) <= 0) {
                resultDiv.innerHTML = '<p class="error">Please enter a valid size (positive number)</p>';
                return;
            }
            
            // Show loading indicator
            loadingIndicator.style.display = 'block';
            resultDiv.innerHTML = '';
            
            try {
                // Call the Netlify function endpoint
                const response = await fetch('/.netlify/functions/qr-code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: content,
                        size: parseInt(size)
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Hide loading indicator
                loadingIndicator.style.display = 'none';
                
                // Display the QR code
                resultDiv.innerHTML = `
                    <p>QR Code Generated Successfully</p>
                    <img id="qrImage" src="${data.qrImageBase64}" alt="QR Code">
                    <p>Scan with your phone's camera to use</p>
                    <p><a href="${data.qrImageBase64}" download="qrcode.png">Download QR Code</a></p>
                `;
            } catch (error) {
                // Hide loading indicator
                loadingIndicator.style.display = 'none';
                
                resultDiv.innerHTML = `
                    <p class="error">Error generating QR code: ${error.message}</p>
                `;
                console.error('Error:', error);
            }
        });
    </script>
</body>
</html>
